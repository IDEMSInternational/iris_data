<!DOCTYPE html>
<html>
<script>
    document.addEventListener("DOMContentLoaded", async () => {
        const dataContainer = document.getElementById("data-container");
        const downloadButton = document.querySelector("button");

        // Extract the value of 'n' from the external source
        var n = {#data_set_number#};

        try {
            const response = await fetch("https://raw.githubusercontent.com/IDEMSInternational/iris_data/main/all_data.json");
            const jsonData = await response.json();

            const dataset = jsonData.find(entry => entry.n === n);

            // Function to convert dataset to CSV format
            function convertToCSV(data) {
                const header = data.header.join(",");
                const rows = data.data.map(row => row.join(",")).join("\n");
                return `${header}\n${rows}`;
            }

            // Function to trigger CSV download
            function downloadCSV(content, filename) {
                const blob = new Blob([content], { type: "text/csv" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            }

            // Function to export dataset to CSV
            function exportToCsv() {
                const csvContent = convertToCSV(dataset);
                const filename = `data_${n}.csv`;
                downloadCSV(csvContent, filename);
            }

            // Attach export function to the download button
            downloadButton.addEventListener("click", exportToCsv);

        } catch (error) {
            dataContainer.innerHTML = "Error loading JSON data.";
            console.error("Error fetching JSON data:", error);
        }
    });
</script>
<body>
    <h1>JSON Data Viewer</h1>
    <p><button onclick="exportToCsv()">Download Data</button></p>
    <div id="data-container"></div>
</body>
</html>
